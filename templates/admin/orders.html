{% extends 'admin/base.html' %}
{% block body %}
  <h1>Orders</h1>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Order Summary</th>
        <th>Shipping Info</th>
        <th>Total</th>
        <th>Status</th>
        <th>Email</th>
        <th>Full Name</th>
        <th>Shipping Address</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for order_id, order in orders.items() %}
        <tr>
          <td>{{ order_id }}</td>
          <td>
            {% set summary = order.get('order_summary', '{}')|fromjson %}
            {% if summary.products is defined and summary.products %}
              {% for product in summary.products %}
                <p><strong>Product Name:</strong> {{ product.product_name|default('N/A') }}<br>
                   <strong>Description:</strong> {{ product.description|default('N/A') }}<br>
                   <strong>Quantity:</strong> {{ product.quantity|default(0) }}</p>
              {% endfor %}
            {% else %}
              <p>Raw Order Summary: {{ order.get('order_summary', 'N/A') }}</p>
            {% endif %}
          </td>
          <td>
            {% set shipping_info = order.get('shipping_info', '{}')|fromjson %}
            {% if shipping_info %}
              {% if shipping_info.shipping_full_name %}
                Full Name: {{ shipping_info.shipping_full_name }}<br>
              {% endif %}
              {% if shipping_info.shipping_email %}
                Email: {{ shipping_info.shipping_email }}<br>
              {% endif %}
            {% else %}
              N/A
            {% endif %}
          </td>
          <td>
            {% set total = order.get('total', 0) %}
            ${{ "%.2f"|format(total) if total is number else '0.00' }}
          </td>
          <td>{{ order.get('status', 'pending') }}</td>
          <td>{{ (order.get('shipping_info', '{}')|fromjson).get('shipping_email', order.get('email', '')) }}</td>
          <td>{{ (order.get('shipping_info', '{}')|fromjson).get('shipping_full_name', order.get('full_name', '')) }}</td>
          <td>
            {% set shipping_info = order.get('shipping_info', '{}')|fromjson %}
            {% if shipping_info %}
              {% if shipping_info.shipping_address1 %}{{ shipping_info.shipping_address1 }}<br>{% endif %}
              {% if shipping_info.shipping_address2 %}{{ shipping_info.shipping_address2 }}{% endif %}
            {% else %}
              N/A
            {% endif %}
          </td>
          <td>
            <a href="{{ url_for('orderview.edit', order_id=order_id) }}" class="btn btn-sm btn-primary">Edit</a>
            <a href="{{ url_for('orderview.delete', order_id=order_id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}