{% extends 'admin/base.html' %}
{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">Orders</h1>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Order ID</th>
                    <th>Order Summary</th>
                    <th>Shipping Info</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Email</th>
                    <th>Full Name</th>
                    <th>Shipping Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for order_id, order in orders.items() %}
                <tr>
                    <td>{{ order_id }}</td>
                    <td>
                        {% set summary = order.get('order_summary', '{}')|fromjson %}
                        {% if summary.products is defined and summary.products %}
                            {% for product in summary.products %}
                                <p><strong>Product Name:</strong> {{ product.product_name|default('N/A') }}</p>
                                <p><strong>Description:</strong> {{ product.description|default('N/A') }}</p>
                                <p><strong>Quantity:</strong> {{ product.quantity|default(0) }}</p>
                            {% endfor %}
                        {% else %}
                            <p><strong>Raw Order Summary:</strong> {{ order.get('order_summary', 'N/A') }}</p>
                        {% endif %}
                    </td>
                    <td>
                        {% set shipping_info = order.get('shipping_info', '{}')|fromjson %}
                        {% if shipping_info %}
                            {% if shipping_info.shipping_full_name %}
                                <p><strong>Full Name:</strong> {{ shipping_info.shipping_full_name }}</p>
                            {% endif %}
                            {% if shipping_info.shipping_email %}
                                <p><strong>Email:</strong> {{ shipping_info.shipping_email }}</p>
                            {% endif %}
                        {% else %}
                            <p>N/A</p>
                        {% endif %}
                    </td>
                    <td>â‚±{{ "%.2f"|format(order.get('total', 0)) if order.get('total', 0) is number else '0.00' }}</td>
                    <td>{{ order.get('status', 'pending') }}</td>
                    <td>{{ (order.get('shipping_info', '{}')|fromjson).get('shipping_email', order.get('email', '')) }}</td>
                    <td>{{ (order.get('shipping_info', '{}')|fromjson).get('shipping_full_name', order.get('full_name', '')) }}</td>
                    <td>
                        {% set shipping_info = order.get('shipping_info', '{}')|fromjson %}
                        {% if shipping_info %}
                            {% if shipping_info.shipping_address1 %}{{ shipping_info.shipping_address1 }}<br>{% endif %}
                            {% if shipping_info.shipping_address2 %}{{ shipping_info.shipping_address2 }}{% endif %}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td class="flex flex-col space-y-2">
    <a href="{{ url_for('orderview.edit', order_id=order_id) }}" class="btn btn-sm btn-custom">Edit</a>
    <a href="{{ url_for('orderview.delete', order_id=order_id) }}" class="btn btn-sm btn-danger">Delete</a>
</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
{% block scripts %}
    <style>
        .btn-custom {
            background-color: #ffffff;
            color: #000000;
            border: 1px solid #000000;
        }
        .btn-custom:hover {
            background-color: #000000;
            color: #ffffff;
        }
    </style>
{% endblock %}